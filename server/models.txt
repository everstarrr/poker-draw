-- Таблица Users
CREATE TABLE Users (
    email VARCHAR(255) PRIMARY KEY,
    username VARCHAR(30) UNIQUE NOT NULL,
    last_activity TIMESTAMP,
    password VARCHAR(255) NOT NULL
);

-- Таблица Games
CREATE TABLE Games (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(32) NOT NULL,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    max_players INTEGER NOT NULL,
    max_turn_time INTEGER NOT NULL,
    big_blind INTEGER NOT NULL,
    min_stack INTEGER NOT NULL,
    max_stack INTEGER NOT NULL,
    pot INTEGER DEFAULT 0,
    turn_start_time	TIMESTAMP,
    current_player_id UUID
);

-- Таблица Cards
CREATE TABLE Cards (
    id SERIAL PRIMARY KEY,
    suit VARCHAR(10) CHECK (suit IN ('HEART', 'DIAMONDS', 'CLUB', 'SPADE')),
    number CHAR(1) NOT NULL
);

-- Таблица Players
CREATE TABLE Players (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    position INTEGER NOT NULL,
    status VARCHAR(10) CHECK (status IN ('RAISE', 'CALL', 'CHECK', 'FOLD', 'ALL-IN')),
    email VARCHAR(255) NOT NULL,
    game_id UUID NOT NULL,
    stack INTEGER NOT NULL,
    FOREIGN KEY (email) REFERENCES Users(email) ON DELETE CASCADE,
    FOREIGN KEY (game_id) REFERENCES Games(id) ON DELETE CASCADE
);

-- Таблица Deck
CREATE TABLE Deck (
    card_id INTEGER NOT NULL,
    game_id UUID NOT NULL,
    PRIMARY KEY (card_id, game_id),
    FOREIGN KEY (card_id) REFERENCES Cards(id) ON DELETE CASCADE,
    FOREIGN KEY (game_id) REFERENCES Games(id) ON DELETE CASCADE
);

-- Таблица Players_Cards
CREATE TABLE Players_Cards (
    card_id INTEGER NOT NULL,
    player_id UUID NOT NULL,
    PRIMARY KEY (card_id, player_id),
    FOREIGN KEY (card_id) REFERENCES Cards(id) ON DELETE CASCADE,
    FOREIGN KEY (player_id) REFERENCES Players(id) ON DELETE CASCADE
);

-- Таблица Bets
CREATE TABLE Bets (
    player_id UUID PRIMARY KEY,
    amount INTEGER NOT NULL DEFAULT 0,
    FOREIGN KEY (player_id) REFERENCES Players(id) ON DELETE CASCADE
);